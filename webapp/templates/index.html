<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate">
<title>SmartGlass AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
/*============================================================
  SMARTGLASS AI  â€“  Elegant Single-Page UI
============================================================*/
:root {
  --bg: #f5f6f8; --surface: #ffffff; --border: #e4e7ec;
  --text: #0f172a; --muted: #64748b; --accent: #4f46e5;
  --accent-light: #eef2ff; --accent-dark: #4338ca;
  --green: #10b981; --green-bg: #ecfdf5; --green-text: #065f46;
  --red: #ef4444; --red-bg: #fef2f2; --red-text: #991b1b;
  --orange: #f59e0b; --orange-bg: #fffbeb;
  --radius: 14px; --radius-sm: 8px;
  --shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
  --shadow-lg: 0 10px 30px rgba(0,0,0,.08);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:15px;scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh}
img{max-width:100%;display:block}
input,select,textarea,button{font:inherit}

/* â”€â”€â”€ Scrollbar â”€â”€â”€ */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  position:sticky;top:0;z-index:500;
  display:flex;align-items:center;gap:.75rem;
  background:var(--surface);border-bottom:1px solid var(--border);
  padding:0 2rem;height:60px;
  backdrop-filter:blur(12px);background:rgba(255,255,255,.92);
}
.logo{font-weight:900;font-size:1.25rem;letter-spacing:-.5px;margin-right:1.5rem;display:flex;align-items:center;gap:8px}
.logo .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.nav-pills{display:flex;gap:4px;background:var(--bg);padding:4px;border-radius:10px}
.pill{
  border:none;background:none;padding:7px 14px;
  font-weight:500;font-size:.87rem;color:var(--muted);
  border-radius:8px;cursor:pointer;transition:all .15s;
  white-space:nowrap;
}
.pill:hover{color:var(--text);background:var(--surface)}
.pill.active{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(79,70,229,.3)}

/* Adapter badge */
.adapter-badge{
  margin-left:auto;display:flex;align-items:center;gap:8px;
  background:var(--accent-light);border:1px solid #c7d2fe;
  padding:6px 14px;border-radius:20px;font-size:.82rem;font-weight:600;
  color:var(--accent);cursor:pointer;position:relative;
  transition:all .15s;
}
.adapter-badge:hover{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,70,229,.1)}
.adapter-badge .live-dot{width:8px;height:8px;border-radius:50%;background:var(--green);flex-shrink:0}
.adapter-dropdown{
  display:none;position:absolute;top:calc(100% + 8px);right:0;
  background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);
  box-shadow:var(--shadow-lg);min-width:300px;overflow:hidden;z-index:600;
}
.adapter-dropdown.open{display:block}
.adapter-dd-head{padding:14px 16px;border-bottom:1px solid var(--border);font-size:.75rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px}
.adapter-opt{
  display:flex;align-items:center;gap:12px;padding:12px 16px;
  cursor:pointer;transition:background .1s;
}
.adapter-opt:hover{background:var(--bg)}
.adapter-opt.active{background:var(--accent-light)}
.adapter-opt .radio{
  width:18px;height:18px;border-radius:50%;border:2px solid #c7d2fe;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.adapter-opt.active .radio{border-color:var(--accent)}
.adapter-opt.active .radio::after{content:'';width:10px;height:10px;border-radius:50%;background:var(--accent)}
.adapter-opt-text strong{display:block;font-size:.9rem}
.adapter-opt-text small{color:var(--muted);font-size:.78rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{display:none}
.page.on{display:block}
.page-wrap{max-width:1240px;margin:0 auto;padding:2rem 2rem 4rem}
.page-header{display:flex;align-items:center;gap:10px;margin-bottom:1.75rem}
.page-header h2{font-size:1.5rem;font-weight:800;letter-spacing:-.4px}
.page-header .tag{font-size:.8rem;padding:4px 10px;border-radius:6px;font-weight:600}

/* â”€â”€â”€ Cards â”€â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow)}
.card-label{font-size:.72rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:1rem;display:flex;align-items:center;gap:6px}

/* â”€â”€â”€ Buttons â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:9px 18px;border:none;border-radius:var(--radius-sm);
  font-weight:600;font-size:.88rem;cursor:pointer;transition:all .15s;
}
.btn-accent{background:var(--accent);color:#fff}
.btn-accent:hover{background:var(--accent-dark);box-shadow:0 4px 12px rgba(79,70,229,.25)}
.btn-accent:disabled{opacity:.5;cursor:not-allowed}
.btn-ghost{background:var(--bg);color:var(--text);border:1px solid var(--border)}
.btn-ghost:hover{background:#e2e8f0}
.btn-danger{background:var(--red-bg);color:var(--red-text);border:1px solid #fecaca}
.btn-danger:hover{background:#fee2e2}
.btn-sm{padding:5px 12px;font-size:.8rem;border-radius:6px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{text-align:center;padding:5rem 1rem 3rem}
.hero-badge{
  display:inline-flex;align-items:center;gap:6px;
  background:var(--accent-light);color:var(--accent);
  font-weight:600;font-size:.82rem;padding:6px 14px;border-radius:20px;
  margin-bottom:1.5rem;
}
.hero h1{font-size:3.2rem;font-weight:900;letter-spacing:-1.2px;line-height:1.15;margin-bottom:1rem}
.hero h1 span{background:linear-gradient(135deg,var(--accent),#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{font-size:1.1rem;color:var(--muted);max-width:580px;margin:0 auto 2.5rem}

.feat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.25rem;margin:3rem 0}
.feat{padding:1.75rem}
.feat .emoji{font-size:1.8rem;margin-bottom:.75rem;display:block}
.feat h3{font-size:1rem;font-weight:700;margin-bottom:.4rem}
.feat p{font-size:.88rem;color:var(--muted)}

.about-card{display:flex;align-items:center;gap:1.25rem;padding:1.5rem;margin-top:3rem}
.about-av{
  width:56px;height:56px;border-radius:50%;
  background:linear-gradient(135deg,var(--accent),#7c3aed);color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:1.25rem;flex-shrink:0;
}
.about-text h4{font-weight:700;font-size:1.05rem}
.about-text p{color:var(--muted);font-size:.9rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.det-grid{display:grid;grid-template-columns:1fr 300px;gap:1.25rem}
@media(max-width:900px){.det-grid{grid-template-columns:1fr}}

.vid-box{
  background:#0a0a0a;border-radius:var(--radius);overflow:hidden;
  position:relative;min-height:380px;resize:both;
}
.vid-box img{width:100%;height:100%;object-fit:contain}
.vid-ph{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:380px;color:#555;gap:.75rem;
}
.vid-ph .cam{font-size:2.5rem}

.side-col{display:flex;flex-direction:column;gap:1.25rem}

.stat-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bg)}
.stat-row:last-child{border:none}
.stat-k{color:var(--muted);font-size:.88rem}
.stat-v{font-weight:700;font-size:.88rem}

.det-item{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--bg)}
.det-item:last-child{border:none}
.det-name{font-weight:600;font-size:.88rem}
.det-conf{font-size:.78rem;font-weight:700;padding:3px 8px;border-radius:5px;background:var(--green-bg);color:var(--green-text)}

/* â”€â”€â”€ Upload zone â”€â”€â”€ */
.drop-zone{
  border:2px dashed var(--border);border-radius:var(--radius);
  padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .2s;
}
.drop-zone:hover{border-color:var(--accent);background:var(--accent-light)}
.drop-zone.over{border-color:var(--accent);background:var(--accent-light)}
.drop-zone .dz-icon{font-size:2.2rem;margin-bottom:.75rem}
.drop-zone h3{font-weight:700;font-size:1rem;margin-bottom:.25rem}
.drop-zone p{color:var(--muted);font-size:.85rem}

/* Dataset badge */
.ds-badge{
  display:flex;align-items:center;gap:.75rem;padding:1rem;
  background:var(--accent-light);border:1px solid #c7d2fe;border-radius:var(--radius-sm);
}
.ds-badge .ds-ico{
  width:42px;height:42px;border-radius:10px;background:var(--accent);color:#fff;
  display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;
}
.ds-badge .ds-txt strong{display:block;font-size:.95rem}
.ds-badge .ds-txt small{color:var(--muted);font-size:.8rem}

/* â”€â”€â”€ Training layout â”€â”€â”€ */
.train-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
@media(max-width:768px){.train-grid{grid-template-columns:1fr}}

.form-row{margin-bottom:1rem}
.form-row label{display:block;font-weight:600;font-size:.85rem;margin-bottom:4px}
.form-input{
  width:100%;padding:9px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);
  background:var(--surface);transition:border .15s;
}
.form-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,70,229,.1)}

.prog-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden;margin:1rem 0}
.prog-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .3s}

/* â”€â”€â”€ Models grid â”€â”€â”€ */
.models-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.25rem}
.m-head{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem}
.m-head .m-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.m-head h3{font-weight:700;font-size:1rem}
.m-meta{font-size:.85rem;color:var(--muted)}
.m-meta span{display:block;padding:5px 0;border-bottom:1px solid var(--bg)}
.m-meta span:last-child{border:none}
.badge{display:inline-block;padding:3px 9px;border-radius:5px;font-size:.75rem;font-weight:700}
.badge-on{background:var(--green-bg);color:var(--green-text)}
.badge-off{background:var(--bg);color:var(--muted)}

/* â”€â”€â”€ Terminal â”€â”€â”€ */
.terminal{background:#111113;border-radius:var(--radius);overflow:hidden;border:1px solid #2a2a2e}
.term-bar{
  background:#1a1a1e;padding:10px 14px;display:flex;align-items:center;gap:8px;
}
.term-dots{display:flex;gap:6px}
.term-dots span{width:12px;height:12px;border-radius:50%}
.td-r{background:#ff5f57}.td-y{background:#febc2e}.td-g{background:#28c840}
.term-title{color:#787882;font-family:'Consolas','Monaco',monospace;font-size:.8rem;margin-left:.5rem}
.term-bar .spacer{flex:1}
.term-body{
  padding:12px 14px;font-family:'Consolas','Monaco',monospace;
  font-size:.8rem;color:#b0b0b8;max-height:260px;overflow-y:auto;
  white-space:pre-wrap;word-break:break-all;
}
.log-i{color:#67b7f7}.log-w{color:#e5c07b}.log-e{color:#e06c75}

/* â”€â”€â”€ Toast â”€â”€â”€ */
.toasts{position:fixed;top:72px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px}
.toast{
  padding:10px 18px;border-radius:10px;font-size:.88rem;font-weight:600;
  box-shadow:0 6px 16px rgba(0,0,0,.12);animation:tIn .25s ease;
  display:flex;align-items:center;gap:8px;
}
.toast-ok{background:var(--green-bg);color:var(--green-text);border:1px solid #a7f3d0}
.toast-err{background:var(--red-bg);color:var(--red-text);border:1px solid #fecaca}
.toast-info{background:var(--accent-light);color:var(--accent);border:1px solid #c7d2fe}
@keyframes tIn{from{transform:translateX(100%);opacity:0}to{transform:none;opacity:1}}
@keyframes tOut{from{opacity:1}to{opacity:0;transform:translateY(-8px)}}

.hidden{display:none!important}
.mt-1{margin-top:.5rem}.mt-2{margin-top:1rem}.mt-3{margin-top:1.5rem}
.flex{display:flex}.gap-2{gap:.5rem}.gap-3{gap:1rem}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOP BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="topbar">
  <div class="logo">
    <span class="dot"></span> SmartGlass AI
  </div>
  <div class="nav-pills">
    <button class="pill active" data-p="home">&#127968; Home</button>
    <button class="pill" data-p="detect">&#128247; Detection</button>
    <button class="pill" data-p="train">&#128640; Train</button>
    <button class="pill" data-p="models">&#129520; Models</button>
  </div>
  <div class="adapter-badge" id="adapterBadge" onclick="toggleAdapterDD()">
    <span class="live-dot"></span>
    <span id="adapterLabel">&#9889; YOLOv4-tiny</span>
    <span style="font-size:.7rem;color:#a5b4fc">&#9660;</span>
  </div>
  <div class="adapter-dropdown" id="adapterDD">
    <div class="adapter-dd-head">&#128268; Switch Detection Adapter</div>
    <div class="adapter-opt active" data-m="yolo" onclick="switchAdapter('yolo',this)">
      <div class="radio"></div>
      <div class="adapter-opt-text">
        <strong>&#9889; YOLOv4-tiny</strong>
        <small>80 COCO classes &middot; fast &amp; accurate</small>
      </div>
    </div>
    <div class="adapter-opt" data-m="ssd" onclick="switchAdapter('ssd',this)">
      <div class="radio"></div>
      <div class="adapter-opt-text">
        <strong>&#128242; MobileNet-SSD</strong>
        <small>20 VOC classes &middot; ultra lightweight</small>
      </div>
    </div>
  </div>
</nav>
<div class="toasts" id="toasts"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page on" id="page-home">
<div class="page-wrap">
  <div class="hero">
    <div class="hero-badge">&#10024; AI-Powered Smart Glasses Platform</div>
    <h1>See the World Through<br><span>Intelligent Eyes</span></h1>
    <p>Real-time object detection with YOLO &amp; MobileNet-SSD. Upload datasets, train custom models, and deploy &mdash; all from your browser.</p>
    <div class="flex gap-3" style="justify-content:center">
      <button class="btn btn-accent" onclick="go('detect')">&#128247; Start Detection</button>
      <button class="btn btn-ghost" onclick="go('train')">&#128640; Train a Model</button>
    </div>
  </div>

  <div class="feat-grid">
    <div class="card feat">
      <span class="emoji">&#127909;</span>
      <h3>Live Camera Detection</h3>
      <p>Stream your webcam and detect 80+ objects in real-time. Dynamically resizable feed with FPS overlay.</p>
    </div>
    <div class="card feat">
      <span class="emoji">&#129302;</span>
      <h3>Custom Model Training</h3>
      <p>Upload image, audio, or text datasets as .zip files. Auto-detects type, trains the right model, and hot-reloads.</p>
    </div>
    <div class="card feat">
      <span class="emoji">&#128260;</span>
      <h3>Adapter Switching</h3>
      <p>Hot-swap between YOLOv4-tiny, MobileNet-SSD, and custom-trained models without restarting the server.</p>
    </div>
    <div class="card feat">
      <span class="emoji">&#128421;</span>
      <h3>Live Server Terminal</h3>
      <p>Integrated CLI with real-time SSE log streaming. Watch training progress, detection stats, and system events.</p>
    </div>
  </div>

  <div class="card about-card">
    <div class="about-av">AR</div>
    <div class="about-text">
      <h4>Akshay Raj</h4>
      <p>Smart Glasses Project &mdash; Object Detection with OpenCV, YOLOv4, MobileNet-SSD, and PyTorch. Built for wearable AI applications.</p>
    </div>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DETECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-detect">
<div class="page-wrap">
  <div class="page-header">
    <h2>&#128247; Live Detection</h2>
    <span class="tag" id="detAdapterTag" style="background:var(--accent-light);color:var(--accent)">&#9889; YOLOv4-tiny</span>
  </div>

  <div class="det-grid">
    <div>
      <!-- Camera -->
      <div class="card" style="padding:1rem">
        <div class="card-label">&#127909; Camera Feed</div>
        <div class="vid-box" id="vidBox">
          <div class="vid-ph" id="vidPh">
            <span class="cam">&#128247;</span>
            <span>Click <strong>Start Camera</strong> to begin</span>
          </div>
          <img id="vidFeed" class="hidden" alt="Live feed">
        </div>
        <div class="flex gap-2 mt-2">
          <button class="btn btn-accent" id="camBtn" onclick="toggleCam()">&#9654; Start Camera</button>
        </div>
      </div>

      <!-- Image Upload -->
      <div class="card mt-2">
        <div class="card-label">&#128444;&#65039; Image Detection</div>
        <div class="drop-zone" id="imgDZ" onclick="document.getElementById('imgIn').click()">
          <div class="dz-icon">&#128444;&#65039;</div>
          <h3>Drop an image or click to browse</h3>
          <p>JPG, PNG, BMP, TIFF, WebP supported</p>
          <input type="file" id="imgIn" accept="image/*" class="hidden" onchange="detectImg(this)">
        </div>
        <div id="imgResult" class="hidden mt-2"></div>
      </div>

      <!-- Terminal -->
      <div class="terminal mt-2">
        <div class="term-bar">
          <div class="term-dots"><span class="td-r"></span><span class="td-y"></span><span class="td-g"></span></div>
          <span class="term-title">&#128421; server logs</span>
          <span class="spacer"></span>
          <button class="btn-sm btn-ghost" style="background:#222;color:#888;border:none" onclick="clearTerm()">Clear</button>
        </div>
        <div class="term-body" id="termBody"><div class="log-i">Connecting to server...</div></div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="side-col">
      <div class="card">
        <div class="card-label">&#128202; Statistics</div>
        <div class="stat-row"><span class="stat-k">&#128268; Adapter</span><span class="stat-v" id="sAdapter">YOLOv4-tiny</span></div>
        <div class="stat-row"><span class="stat-k">&#9889; FPS</span><span class="stat-v" id="sFps">--</span></div>
        <div class="stat-row"><span class="stat-k">&#128230; Objects</span><span class="stat-v" id="sObj">0</span></div>
        <div class="stat-row"><span class="stat-k">&#127909; Camera</span><span class="stat-v" id="sCam">Off</span></div>
      </div>
      <div class="card">
        <div class="card-label">&#9889; FPS Mode</div>
        <select class="form-input" id="fpsMode" onchange="switchFpsMode(this.value)" style="margin-bottom:.75rem">
          <option value="ultra">âš¡ Ultra (200+ FPS)</option>
          <option value="high">ğŸš€ High (100+ FPS)</option>
          <option value="balanced">âš–ï¸ Balanced (30-60 FPS)</option>
        </select>
        <div style="font-size:.8rem;color:var(--muted);line-height:1.4">
          <div id="fpsDesc">Max FPS, detect every 10th frame</div>
          <div id="fpsStatus" class="mt-1" style="color:var(--accent)">Current: <span id="currentFps">Ultra</span></div>
        </div>
      </div>
      <div class="card">
        <div class="card-label">&#127919; Detected Objects</div>
        <div id="detList"><p style="color:var(--muted);font-size:.85rem">Start camera to see detections</p></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TRAINING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-train">
<div class="page-wrap">
  <div class="page-header">
    <h2>&#128640; Upload &amp; Train</h2>
  </div>

  <div class="train-grid">
    <div>
      <!-- Upload -->
      <div class="card">
        <div class="card-label">&#128230; Dataset</div>
        <div id="dzWrap">
          <div class="drop-zone" id="dsDZ" onclick="document.getElementById('dsIn').click()">
            <div class="dz-icon">&#128229;</div>
            <h3>Drop a .zip archive here</h3>
            <p>Supports image, audio, and text datasets</p>
            <input type="file" id="dsIn" accept=".zip,.tar,.gz,.tgz" class="hidden" onchange="uploadDS(this)">
          </div>
        </div>
        <div id="dsDisplay" class="hidden mt-2"></div>
        <div id="uploadProg" class="hidden mt-1">
          <p style="font-size:.85rem;color:var(--muted)">&#9203; Uploading and extracting...</p>
          <div class="prog-bar"><div class="prog-fill" style="width:30%"></div></div>
        </div>
      </div>

      <!-- Config -->
      <div class="card mt-2">
        <div class="card-label">&#9881;&#65039; Configuration</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
          <div class="form-row"><label>Epochs</label><input class="form-input" type="number" id="cfgEp" value="10" min="1" max="200"></div>
          <div class="form-row"><label>Batch Size</label><input class="form-input" type="number" id="cfgBs" value="32" min="1" max="512"></div>
          <div class="form-row"><label>Learning Rate</label><input class="form-input" type="number" id="cfgLr" value="0.001" step="0.0001"></div>
          <div class="form-row"><label>ETA</label><input class="form-input" type="text" id="cfgEta" value="--" readonly></div>
        </div>
        <div class="flex gap-2 mt-2">
          <button class="btn btn-accent" id="trainBtn" onclick="startTrain()" disabled>&#128640; Start Training</button>
          <button class="btn btn-danger hidden" id="clearDsBtn" onclick="clearDS()">&#128465; Clear Dataset</button>
        </div>
      </div>
    </div>

    <!-- Progress -->
    <div>
      <div class="card">
        <div class="card-label">&#128200; Training Progress</div>
        <div id="trainStat"><p style="color:var(--muted);font-size:.85rem">Upload a dataset to begin</p></div>
        <div class="prog-bar hidden" id="trainProg"><div class="prog-fill" id="trainFill" style="width:0%"></div></div>
      </div>
      <div class="card mt-2">
        <div class="card-label">&#128202; Training Chart</div>
        <div style="position:relative;height:220px"><canvas id="trainChart"></canvas></div>
      </div>
      <!-- Adapter status after training -->
      <div class="card mt-2 hidden" id="trainAdapterCard">
        <div class="card-label">&#128268; Active Adapter After Training</div>
        <div id="trainAdapterInfo"></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODELS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-models">
<div class="page-wrap">
  <div class="page-header">
    <h2>&#129520; Models</h2>
    <span style="flex:1"></span>
    <button class="btn btn-ghost" onclick="loadModels()">&#128260; Reload</button>
  </div>
  <div class="models-grid" id="modelsGrid"><div class="card"><p style="color:var(--muted)">Loading...</p></div></div>
</div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€â”€ State â”€â”€â”€â”€ */
let camOn=false, detTimer=null, logES=null, trainES=null, dsPath=null, chart=null;
const hist={labels:[],loss:[],acc:[]};

/* â”€â”€â”€â”€ Navigation â”€â”€â”€â”€ */
document.querySelectorAll('.pill').forEach(b=>b.addEventListener('click',()=>go(b.dataset.p)));
function go(p){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('on'));
  document.querySelectorAll('.pill').forEach(x=>x.classList.remove('active'));
  const pg=document.getElementById('page-'+p);if(pg)pg.classList.add('on');
  const tb=document.querySelector(`.pill[data-p="${p}"]`);if(tb)tb.classList.add('active');
  if(p==='detect')initLogs();
  if(p==='models')loadModels();
}

/* â”€â”€â”€â”€ Toast â”€â”€â”€â”€ */
function toast(msg,type='info'){
  const t=document.createElement('div');
  t.className='toast toast-'+(type==='error'?'err':type==='success'?'ok':'info');
  t.textContent=msg;
  document.getElementById('toasts').appendChild(t);
  setTimeout(()=>{t.style.animation='tOut .3s ease';setTimeout(()=>t.remove(),300)},3500);
}

/* â”€â”€â”€â”€ Adapter switcher â”€â”€â”€â”€ */
function toggleAdapterDD(){document.getElementById('adapterDD').classList.toggle('open')}
document.addEventListener('click',e=>{if(!e.target.closest('.adapter-badge')&&!e.target.closest('.adapter-dropdown'))document.getElementById('adapterDD').classList.remove('open')});

async function switchAdapter(m,el){
  try{
    const r=await fetch('/api/models/switch',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:m})});
    const d=await r.json();
    if(d.ok){
      setAdapterUI(d.active);
      document.querySelectorAll('.adapter-opt').forEach(o=>o.classList.remove('active'));
      el.classList.add('active');
      toast('Switched to '+d.active,'success');
    }else toast(d.error||'Switch failed','error');
  }catch(e){toast('Network error','error')}
  document.getElementById('adapterDD').classList.remove('open');
}
function setAdapterUI(name){
  const emoji=name.includes('YOLO')?'\u26A1':'\uD83D\uDCF1';
  document.getElementById('adapterLabel').innerHTML=emoji+' '+name;
  document.getElementById('sAdapter').textContent=name;
  document.getElementById('detAdapterTag').innerHTML=emoji+' '+name;
}

/* â”€â”€â”€â”€ Camera â”€â”€â”€â”€ */
async function toggleCam(){
  if(camOn){
    await fetch('/api/video/stop',{method:'POST'});
    document.getElementById('vidFeed').classList.add('hidden');
    document.getElementById('vidPh').classList.remove('hidden');
    document.getElementById('camBtn').innerHTML='\u25B6 Start Camera';
    document.getElementById('camBtn').className='btn btn-accent';
    document.getElementById('sCam').textContent='Off';
    document.getElementById('sFps').textContent='--';
    document.getElementById('sObj').textContent='0';
    document.getElementById('detList').innerHTML='<p style="color:var(--muted);font-size:.85rem">Camera stopped</p>';
    camOn=false;if(detTimer){clearInterval(detTimer);detTimer=null}
  }else{
    try{
      await fetch('/api/video/start',{method:'POST'});
      const f=document.getElementById('vidFeed');f.src='/api/video/feed?t='+Date.now();
      f.classList.remove('hidden');document.getElementById('vidPh').classList.add('hidden');
      document.getElementById('camBtn').innerHTML='\u23F9 Stop Camera';
      document.getElementById('camBtn').className='btn btn-danger';
      document.getElementById('sCam').textContent='Live';
      camOn=true;detTimer=setInterval(pollDets,600);
      toast('Camera started','success');
    }catch(e){toast('Cannot open camera','error')}
  }
}
async function pollDets(){
  try{
    const r=await fetch('/api/video/detections');const d=await r.json();
    document.getElementById('sFps').textContent=d.fps||'--';
    const dets=d.detections||[];
    document.getElementById('sObj').textContent=dets.length;
    if(!dets.length){document.getElementById('detList').innerHTML='<p style="color:var(--muted);font-size:.85rem">No objects detected</p>';return}
    document.getElementById('detList').innerHTML=dets.map(x=>`<div class="det-item"><span class="det-name">${x.label}</span><span class="det-conf">${(x.confidence*100).toFixed(1)}%</span></div>`).join('');
  }catch(e){}
}

/* â”€â”€â”€â”€ Image Detection â”€â”€â”€â”€ */
async function detectImg(inp){
  if(!inp.files[0])return;
  const fd=new FormData();fd.append('file',inp.files[0]);
  const el=document.getElementById('imgResult');
  el.innerHTML='<p style="color:var(--muted)">&#9203; Detecting...</p>';el.classList.remove('hidden');
  try{
    const r=await fetch('/api/detect/image',{method:'POST',body:fd});const d=await r.json();
    if(d.ok){el.innerHTML=`<img src="data:image/jpeg;base64,${d.image}" style="border-radius:10px"><p class="mt-1" style="font-size:.88rem;font-weight:600">\u2705 ${d.total} object(s) detected</p>`;toast(d.total+' object(s) found','success')}
    else el.innerHTML=`<p style="color:var(--red)">${d.error}</p>`;
  }catch(e){el.innerHTML='<p style="color:var(--red)">Upload failed</p>'}
  inp.value='';
}

/* â”€â”€â”€â”€ Logs â”€â”€â”€â”€ */
function initLogs(){
  if(logES)return;
  fetch('/api/logs').then(r=>r.json()).then(d=>{
    const b=document.getElementById('termBody');b.innerHTML='';
    (d.lines||[]).forEach(l=>addLog(l));
  });
  logES=new EventSource('/api/logs/stream');
  logES.onmessage=e=>addLog(JSON.parse(e.data));
}
function addLog(l){
  const b=document.getElementById('termBody'),d=document.createElement('div');
  d.className=l.includes('[ERROR]')||l.includes('[CRITICAL]')?'log-e':l.includes('[WARNING]')?'log-w':'log-i';
  d.textContent=l;b.appendChild(d);b.scrollTop=b.scrollHeight;
  while(b.children.length>500)b.removeChild(b.firstChild);
}
function clearTerm(){document.getElementById('termBody').innerHTML='<div class="log-i">Terminal cleared</div>'}

/* â”€â”€â”€â”€ Dataset Upload â”€â”€â”€â”€ */
async function uploadDS(inp){
  if(!inp.files[0])return;
  const fd=new FormData();fd.append('file',inp.files[0]);
  document.getElementById('uploadProg').classList.remove('hidden');
  document.getElementById('dzWrap').classList.add('hidden');
  try{
    const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();
    document.getElementById('uploadProg').classList.add('hidden');
    if(d.ok){
      dsPath=d.dataset_path;
      const typeEmoji=d.dataset_type==='image'?'\uD83D\uDDBC\uFE0F':d.dataset_type==='audio'?'\uD83C\uDFA4':'\uD83D\uDCDD';
      document.getElementById('dsDisplay').innerHTML=`
        <div class="ds-badge">
          <div class="ds-ico">${typeEmoji}</div>
          <div class="ds-txt">
            <strong>${d.dataset_name||'Dataset'}</strong>
            <small>${d.dataset_type} dataset &middot; ${d.num_files} files &middot; ${d.num_classes} classes</small>
          </div>
        </div>
        <p class="mt-1" style="font-size:.82rem;color:var(--muted)">\uD83D\uDD17 Adapter: <strong>${document.getElementById('sAdapter').textContent}</strong> (switch anytime from the top bar)</p>
      `;
      document.getElementById('dsDisplay').classList.remove('hidden');
      if(d.rec_epochs)document.getElementById('cfgEp').value=d.rec_epochs;
      if(d.rec_batch_size)document.getElementById('cfgBs').value=d.rec_batch_size;
      if(d.eta_display)document.getElementById('cfgEta').value=d.eta_display;
      document.getElementById('trainBtn').disabled=false;
      document.getElementById('clearDsBtn').classList.remove('hidden');
      toast('\u2705 Dataset uploaded: '+(d.dataset_name||d.dataset_type),'success');
    }else{
      document.getElementById('dzWrap').classList.remove('hidden');
      toast(d.error||'Upload failed','error');
    }
  }catch(e){
    document.getElementById('uploadProg').classList.add('hidden');
    document.getElementById('dzWrap').classList.remove('hidden');
    toast('Upload failed','error');
  }
  inp.value='';
}
async function clearDS(){
  if(dsPath)await fetch('/api/upload/clear',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({dataset_path:dsPath})});
  dsPath=null;
  document.getElementById('dsDisplay').classList.add('hidden');
  document.getElementById('dzWrap').classList.remove('hidden');
  document.getElementById('trainBtn').disabled=true;
  document.getElementById('clearDsBtn').classList.add('hidden');
  document.getElementById('cfgEta').value='--';
  toast('Dataset cleared','info');
}

/* â”€â”€â”€â”€ Training â”€â”€â”€â”€ */
async function startTrain(){
  if(!dsPath){toast('Upload a dataset first','error');return}
  try{
    const r=await fetch('/api/train',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({dataset_path:dsPath,epochs:document.getElementById('cfgEp').value,batch_size:document.getElementById('cfgBs').value,lr:document.getElementById('cfgLr').value})});
    const d=await r.json();
    if(d.ok){
      document.getElementById('trainBtn').disabled=true;
      document.getElementById('trainBtn').innerHTML='\u23F3 Training...';
      document.getElementById('trainProg').classList.remove('hidden');
      hist.labels=[];hist.loss=[];hist.acc=[];initChart();startTrainStream();
      toast('\uD83D\uDE80 Training started','success');
    }else toast(d.error||'Failed','error');
  }catch(e){toast('Network error','error')}
}
function startTrainStream(){
  if(trainES)trainES.close();
  trainES=new EventSource('/api/train/status/stream');
  trainES.onmessage=e=>updateTrain(JSON.parse(e.data));
}
function updateTrain(d){
  const el=document.getElementById('trainStat');
  if(d.status==='training'){
    const pct=d.total_epochs>0?Math.round(d.epoch/d.total_epochs*100):0;
    el.innerHTML=`
      <div class="stat-row"><span class="stat-k">Status</span><span class="stat-v">\uD83D\uDD25 Training</span></div>
      <div class="stat-row"><span class="stat-k">Epoch</span><span class="stat-v">${d.epoch} / ${d.total_epochs}</span></div>
      ${d.loss!=null?`<div class="stat-row"><span class="stat-k">Loss</span><span class="stat-v">${Number(d.loss).toFixed(4)}</span></div>`:''}
      ${d.accuracy!=null?`<div class="stat-row"><span class="stat-k">Accuracy</span><span class="stat-v">${(Number(d.accuracy)*100).toFixed(1)}%</span></div>`:''}
    `;
    document.getElementById('trainFill').style.width=pct+'%';
    if(d.epoch>0&&d.loss!=null){
      const lbl='E'+d.epoch;
      if(!hist.labels.includes(lbl)){hist.labels.push(lbl);hist.loss.push(Number(d.loss));hist.acc.push(d.accuracy!=null?Number(d.accuracy)*100:null);if(chart)chart.update()}
    }
  }else if(d.status==='done'){
    el.innerHTML='<div style="text-align:center;padding:1rem"><span style="font-size:2rem">\u2705</span><p style="font-weight:700;margin-top:.5rem">Training Complete</p></div>';
    document.getElementById('trainBtn').disabled=false;
    document.getElementById('trainBtn').innerHTML='\uD83D\uDE80 Start Training';
    // Show adapter info after training
    const ac=document.getElementById('trainAdapterCard');
    ac.classList.remove('hidden');
    const adName=document.getElementById('sAdapter').textContent;
    document.getElementById('trainAdapterInfo').innerHTML=`
      <div class="ds-badge" style="background:var(--green-bg);border-color:#a7f3d0">
        <div class="ds-ico" style="background:var(--green)">\u2705</div>
        <div class="ds-txt">
          <strong>Model ready &middot; Hot-reloaded</strong>
          <small>Active adapter: <strong>${adName}</strong> + new custom model</small>
        </div>
      </div>
    `;
    toast('\u2705 Training complete! Model hot-reloaded.','success');
    if(trainES){trainES.close();trainES=null}
  }else if(d.status==='error'){
    el.innerHTML=`<p style="color:var(--red)">\u274C ${d.message||'Training error'}</p>`;
    document.getElementById('trainBtn').disabled=false;
    document.getElementById('trainBtn').innerHTML='\uD83D\uDE80 Start Training';
    if(trainES){trainES.close();trainES=null}
  }
}
function initChart(){
  const ctx=document.getElementById('trainChart').getContext('2d');
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{labels:hist.labels,datasets:[
    {label:'Loss',data:hist.loss,borderColor:'#4f46e5',backgroundColor:'rgba(79,70,229,.1)',tension:.3,fill:true,yAxisID:'y'},
    {label:'Accuracy %',data:hist.acc,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,.1)',tension:.3,fill:false,yAxisID:'y1'}
  ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{position:'bottom',labels:{usePointStyle:true,boxWidth:6}}},scales:{y:{position:'left',title:{display:true,text:'Loss'},beginAtZero:true},y1:{position:'right',title:{display:true,text:'Acc %'},beginAtZero:true,max:100,grid:{drawOnChartArea:false}}}}});
}

/* â”€â”€â”€â”€ Models Page â”€â”€â”€â”€ */
async function loadModels(){
  const g=document.getElementById('modelsGrid');
  g.innerHTML='<div class="card"><p style="color:var(--muted)">\u23F3 Loading...</p></div>';
  try{
    const[mr,hr]=await Promise.all([fetch('/api/models'),fetch('/api/models/history')]);
    const models=await mr.json(),history=await hr.json();
    g.innerHTML='';
    if(models.ssd){
      const s=models.ssd;
      const card=document.createElement('div');card.className='card';
      card.innerHTML=`
        <div class="m-head">
          <div class="m-ico" style="background:var(--accent-light);color:var(--accent)">${s.detector&&s.detector.includes('YOLO')?'\u26A1':'\uD83D\uDCF1'}</div>
          <h3>${s.detector||'Detector'}</h3>
        </div>
        <div class="m-meta">
          <span>\uD83C\uDFAF Type: Object Detection</span>
          <span>\uD83D\uDCCA Classes: ${Array.isArray(s.classes)?s.classes.length:'--'}</span>
          <span>Status: ${s.loaded?'<span class="badge badge-on">\u2705 Active</span>':'<span class="badge badge-off">Inactive</span>'}</span>
        </div>
      `;g.appendChild(card);
    }
    for(const item of history){
      const card=document.createElement('div');card.className='card';
      const tl=(item.type||'custom').charAt(0).toUpperCase()+(item.type||'').slice(1);
      const emoji=item.type==='image'?'\uD83D\uDDBC\uFE0F':item.type==='voice'?'\uD83C\uDFA4':'\uD83D\uDCDD';
      card.innerHTML=`
        <div class="m-head">
          <div class="m-ico" style="background:var(--green-bg);color:var(--green-text)">${emoji}</div>
          <h3>${tl} Model</h3>
        </div>
        <div class="m-meta">
          <span>\uD83C\uDFF7\uFE0F Classes: ${Array.isArray(item.classes)?item.classes.join(', '):'--'}</span>
          ${item.accuracy!=null?`<span>\uD83C\uDFAF Accuracy: ${(item.accuracy*100).toFixed(1)}%</span>`:''}
          ${item.trained_at?`<span>\uD83D\uDCC5 Trained: ${item.trained_at}</span>`:''}
          <span>Status: <span class="badge badge-on">\u2705 Ready</span></span>
        </div>
      `;g.appendChild(card);
    }
    for(const mt of['image','voice','text']){
      if(!models[mt]&&!history.find(h=>h.type===mt)){
        const card=document.createElement('div');card.className='card';
        const label=mt.charAt(0).toUpperCase()+mt.slice(1);
        const emoji=mt==='image'?'\uD83D\uDDBC\uFE0F':mt==='voice'?'\uD83C\uDFA4':'\uD83D\uDCDD';
        card.innerHTML=`
          <div class="m-head">
            <div class="m-ico" style="background:var(--bg);color:var(--muted)">${emoji}</div>
            <h3>${label} Model</h3>
          </div>
          <div class="m-meta"><span>Status: <span class="badge badge-off">No model trained</span></span></div>
        `;g.appendChild(card);
      }
    }
    if(!g.children.length)g.innerHTML='<div class="card"><p style="color:var(--muted)">No models found</p></div>';
  }catch(e){g.innerHTML='<div class="card"><p style="color:var(--red)">Failed to load</p></div>'}
}

/* â”€â”€â”€â”€ Drag & drop â”€â”€â”€â”€ */
['dsDZ','imgDZ'].forEach(id=>{
  const z=document.getElementById(id);if(!z)return;
  z.addEventListener('dragover',e=>{e.preventDefault();z.classList.add('over')});
  z.addEventListener('dragleave',()=>z.classList.remove('over'));
  z.addEventListener('drop',e=>{e.preventDefault();z.classList.remove('over');if(e.dataTransfer.files.length){const i=z.querySelector('input[type="file"]');i.files=e.dataTransfer.files;i.dispatchEvent(new Event('change'))}});
});

/* â”€â”€â”€â”€ FPS Mode Control â”€â”€â”€â”€ */
async function switchFpsMode(mode){
  try{
    const r=await fetch('/api/video/fps-mode',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({mode})
    });
    const d=await r.json();
    if(d.ok){
      updateFpsUI(mode,d);
      toast(`Switched to ${mode} FPS mode (${d.estimated_fps})`, 'success');
    }else{
      toast(d.error||'FPS mode switch failed','error');
    }
  }catch(e){
    toast('Network error','error');
  }
}

function updateFpsUI(mode,data){
  const descriptions={
    ultra:'Max FPS, detect every 10th frame',
    high:'High FPS, detect every 5th frame',
    balanced:'Normal FPS, detect every frame'
  };
  document.getElementById('fpsDesc').textContent=descriptions[mode];
  document.getElementById('currentFps').textContent=mode.charAt(0).toUpperCase()+mode.slice(1);
  document.getElementById('fpsMode').value=mode;
}

async function loadFpsMode(){
  try{
    const r=await fetch('/api/video/fps-mode');
    const d=await r.json();
    if(d.ok){
      updateFpsUI(d.current_mode,d);
    }
  }catch(e){
    console.warn('Failed to load FPS mode:',e);
  }
}

/* â”€â”€â”€â”€ Init â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded',()=>{
  fetch('/api/models').then(r=>r.json()).then(d=>{
    if(d.ssd){const n=d.ssd.detector||'YOLOv4-tiny';setAdapterUI(n)}
  }).catch(()=>{});
  loadFpsMode();  // Load current FPS mode
});
</script>
</body>
</html>
